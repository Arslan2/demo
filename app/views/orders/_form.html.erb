<%= form_for(@order, html: { id: 'new_order' }) do |f| %>
  <% if @order.errors.any? %>
    <div class="error_messages">
      <h2><%= pluralize(@order.errors.count, "error") %> prohibited this order from being saved:</h2>
      <ul>
      <% @order.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :amount %>
     <%= @sum %>
    <%= f.hidden_field :amount, value: @sum %>
  </div>

  <% if @discounted_sum.present? %>
    <div class="field">
      <%= f.label :discounted_Price %>
      <%= @discounted_sum %>
      <%= f.hidden_field :discount, value: @discounted_sum %>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :shipping_address %>
    <%= f.text_area :shipping_address, rows: "3", required: true %>
  </div>

  <%= f.hidden_field :stripe_card_token %>

  <% if @order.stripe_card_token %>
    Credit card has been provided
  <% else %>
    <div class="field">
      <%= label_tag :card_number, "Credit Card Number " %>
      <%= text_field_tag :card_number, nil, name: nil, required: true %>
    </div>
    <div class="field">
      <%= label_tag :card_code, "Security Code on Card (CVV)" %>
      <%= text_field_tag :card_code, nil, name: nil, required: true %>
    </div>
    <div class="field">
      <%= label_tag :card_month, "Card Expiration" %>
      <%= select_month nil, {add_month_numbers_true: true}, {name: nil, id: "card_month"} %>
      <%= select_year nil, {start_year: Date.today.year, end_year: Date.today.year+15}, {name: nil, id: "card_year"} %>
    </div>
    <div id="stripe_error">
      <noscript>JavaScript is not enabled and is required for this form. First enable it in your web browser settings.</noscript>
    </div>
  <% end %>
  <div class="actions"><%= f.submit "Purchase Now" %></div>
<% end %>
